# GEMSCAP QUANT PROJECT - ARCHITECTURE DIAGRAM

## System Architecture (ASCII)

```
┌─────────────────────────────────────────────────────────────────────┐
│                         BINANCE EXCHANGE                             │
│                      WebSocket Stream API                            │
└──────────────────────────────┬──────────────────────────────────────┘
                                │
                                │ Real-time Tick Data
                                │ (price, volume, timestamp)
                                │
                                ↓
┌─────────────────────────────────────────────────────────────────────┐
│                      INGESTION LAYER                                 │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │  WebSocket Client (src/ingestion/websocket_client.py)        │  │
│  │  - Multi-symbol subscription                                  │  │
│  │  - Reconnection logic                                         │  │
│  │  - Tick parsing & validation                                  │  │
│  └─────────────────────────┬────────────────────────────────────┘  │
│                             │                                        │
│                             ↓                                        │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │  Data Processor (src/ingestion/data_processor.py)            │  │
│  │  - Tick buffering                                             │  │
│  │  - Data validation                                            │  │
│  │  - Redis Pub/Sub publishing                                   │  │
│  └─────────────────────────┬────────────────────────────────────┘  │
└────────────────────────────┼────────────────────────────────────────┘
                              │
                ┌─────────────┴─────────────┐
                │                           │
                ↓                           ↓
┌───────────────────────────┐   ┌───────────────────────────┐
│     REDIS CACHE           │   │   SQLITE DATABASE         │
│  (Live/Hot Storage)       │   │  (Persistent/Cold)        │
│                           │   │                           │
│  • Sorted Sets            │   │  • ticks table            │
│    - Recent ticks         │   │  • ohlc_1s/1m/5m          │
│    - OHLC samples         │   │  • analytics_results      │
│  • Pub/Sub channels       │   │  • alerts                 │
│  • Key-Value cache        │   │                           │
│  • TTL: ~1000 ticks       │   │  • Full history           │
│                           │   │  • Indexed by symbol      │
│  (src/storage/            │   │                           │
│   redis_manager.py)       │   │  (src/storage/            │
│                           │   │   database.py)            │
└───────────┬───────────────┘   └───────────┬───────────────┘
            │                               │
            └───────────┬───────────────────┘
                        │
                        ↓
┌─────────────────────────────────────────────────────────────────────┐
│                     SAMPLING LAYER                                   │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │  Data Sampler (src/storage/data_sampler.py)                  │  │
│  │  - APScheduler (1s, 1m, 5m intervals)                        │  │
│  │  - OHLC computation from ticks                               │  │
│  │  - Dual write: Redis + SQLite                                │  │
│  └──────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────┘
                        │
                        ↓
┌─────────────────────────────────────────────────────────────────────┐
│                    ANALYTICS ENGINE                                  │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │  Statistical Analytics (src/analytics/statistical.py)        │  │
│  │  • OLS Regression → Hedge Ratio                              │  │
│  │  • Pearson Correlation                                        │  │
│  │  • Rolling Correlation                                        │  │
│  │  • ADF Stationarity Test                                      │  │
│  │  • Cointegration Test                                         │  │
│  └──────────────────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │  Spread Analysis (src/analytics/spread_analysis.py)          │  │
│  │  • Spread = price2 - β*price1                                │  │
│  │  • Z-Score normalization                                      │  │
│  │  • Bollinger Bands                                            │  │
│  │  • Trading signals (LONG/SHORT/EXIT)                          │  │
│  └──────────────────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │  Kalman Filter (src/analytics/kalman_filter.py)              │  │
│  │  • Dynamic hedge ratio estimation                            │  │
│  │  • State-space model                                          │  │
│  │  • Online updates                                             │  │
│  └──────────────────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │  Advanced Metrics (src/analytics/advanced_metrics.py)        │  │
│  │  • Liquidity score                                            │  │
│  │  • Tick velocity                                              │  │
│  │  • Order imbalance                                            │  │
│  │  • Momentum, Volatility                                       │  │
│  └──────────────────────────────────────────────────────────────┘  │
└──────────────────────────┬──────────────────────────────────────────┘
                           │
            ┌──────────────┴──────────────┐
            │                             │
            ↓                             ↓
┌───────────────────────┐     ┌───────────────────────────┐
│   ALERTING SYSTEM     │     │    API LAYER              │
│                       │     │                           │
│  Alert Manager        │     │  FastAPI App (app.py)     │
│  • Rule checking      │     │  ┌─────────────────────┐  │
│  • Threshold alerts   │     │  │  REST Endpoints     │  │
│  • Z-score triggers   │     │  │  • /ohlc/{symbol}   │  │
│  • Volume spikes      │     │  │  • /analytics/*     │  │
│  • Custom rules       │     │  │  • /export/csv      │  │
│  • APScheduler        │     │  │  • /debug/*         │  │
│    (500ms check)      │     │  └─────────────────────┘  │
│                       │     │  ┌─────────────────────┐  │
│  Alert Rules          │     │  │  WebSocket Handler  │  │
│  • Configurable       │     │  │  • /ws/live         │  │
│  • Stored in DB       │     │  │  • Real-time push   │  │
│  • History tracking   │     │  └─────────────────────┘  │
│                       │     │                           │
│  (src/alerting/)      │     │  (src/api/)               │
└───────┬───────────────┘     └───────────┬───────────────┘
        │                                 │
        │        ┌────────────────────────┘
        │        │
        ↓        ↓
┌─────────────────────────────────────────────────────────────────────┐
│                    PRESENTATION LAYER                                │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │  Streamlit Dashboard (streamlit_app.py)                      │  │
│  │  ┌────────────────────────────────────────────────────────┐  │  │
│  │  │  Tab 1: Price Charts                                    │  │  │
│  │  │  - Candlestick charts (Plotly)                         │  │  │
│  │  │  - Volume bars                                         │  │  │
│  │  │  - Real-time metrics                                   │  │  │
│  │  └────────────────────────────────────────────────────────┘  │  │
│  │  ┌────────────────────────────────────────────────────────┐  │  │
│  │  │  Tab 2: Spread Analysis                                │  │  │
│  │  │  - Spread plot with z-score                           │  │  │
│  │  │  - Trading signals                                     │  │  │
│  │  │  - OLS results                                         │  │  │
│  │  └────────────────────────────────────────────────────────┘  │  │
│  │  ┌────────────────────────────────────────────────────────┐  │  │
│  │  │  Tab 3: Correlation                                    │  │  │
│  │  │  - Rolling correlation chart                           │  │  │
│  │  │  - Correlation heatmap                                 │  │  │
│  │  └────────────────────────────────────────────────────────┘  │  │
│  │  ┌────────────────────────────────────────────────────────┐  │  │
│  │  │  Tab 4: Statistics                                     │  │  │
│  │  │  - ADF test results                                    │  │  │
│  │  │  - Stationarity analysis                               │  │  │
│  │  └────────────────────────────────────────────────────────┘  │  │
│  │  ┌────────────────────────────────────────────────────────┐  │  │
│  │  │  Tab 5: Alerts                                         │  │  │
│  │  │  - Alert history                                       │  │  │
│  │  │  - Active rules                                        │  │  │
│  │  └────────────────────────────────────────────────────────┘  │  │
│  │  ┌────────────────────────────────────────────────────────┐  │  │
│  │  │  Tab 6: Debug                                          │  │  │
│  │  │  - System health                                       │  │  │
│  │  │  - Component status                                    │  │  │
│  │  │  - API testing                                         │  │  │
│  │  └────────────────────────────────────────────────────────┘  │  │
│  │                                                              │  │
│  │  Sidebar Controls:                                           │  │
│  │  • Symbol selection                                          │  │
│  │  • Interval selection (1s/1m/5m)                            │  │
│  │  • Rolling window parameter                                 │  │
│  │  • Z-score threshold                                        │  │
│  │  • Auto-refresh toggle                                      │  │
│  └──────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────┘


═══════════════════════════════════════════════════════════════════════
                         DATA FLOW SUMMARY
═══════════════════════════════════════════════════════════════════════

1. INGESTION:  Binance WS → WebSocket Client → Data Processor
2. STORAGE:    Data Processor → Redis (hot) + SQLite (cold)
3. SAMPLING:   Data Sampler (APScheduler) → OHLC → Redis + SQLite
4. ANALYTICS:  Redis/SQLite → Analytics Engine → Results
5. ALERTING:   Analytics → Alert Manager → Notifications
6. API:        Redis/SQLite → FastAPI → REST/WebSocket
7. DASHBOARD:  API → Streamlit → User Interface


═══════════════════════════════════════════════════════════════════════
                      TECHNOLOGY STACK
═══════════════════════════════════════════════════════════════════════

Backend:        FastAPI, Uvicorn, WebSockets
Frontend:       Streamlit, Plotly
Storage:        Redis (in-memory), SQLite (persistent)
Analytics:      NumPy, Pandas, Statsmodels, Scipy, pykalman
Scheduling:     APScheduler
Testing:        pytest, pytest-asyncio
Logging:        Python logging module


═══════════════════════════════════════════════════════════════════════
                      DEPLOYMENT TOPOLOGY
═══════════════════════════════════════════════════════════════════════

Process 1: Redis Server (port 6379)
Process 2: FastAPI Backend (port 8000)
           ├─ WebSocket Client (background task)
           ├─ Data Sampler (APScheduler)
           ├─ Alert Manager (APScheduler)
           └─ API Server (Uvicorn)
Process 3: Streamlit Dashboard (port 8501)

Communication:
- Backend ←→ Redis: redis-py (async)
- Backend ←→ SQLite: aiosqlite
- Dashboard → Backend: HTTP REST + WebSocket
- Binance → Backend: WebSocket (wss://stream.binance.com)


═══════════════════════════════════════════════════════════════════════
                      SCALING CONSIDERATIONS
═══════════════════════════════════════════════════════════════════════

Horizontal Scaling:
- Multiple WebSocket clients (symbol sharding)
- Redis Cluster for distributed cache
- API load balancing (multiple FastAPI instances)

Vertical Scaling:
- Increase Redis memory
- SQLite → PostgreSQL for larger datasets
- Add more APScheduler workers

Performance:
- Redis: <1ms read/write
- OHLC sampling: Every 1s/1m/5m
- Alert checking: Every 500ms
- Dashboard refresh: User-configurable (1-30s)
```
